---
import "../styles/components/cleaningProducts.sass";
import InputField from "./inputForm.astro";

import { products } from "../data/products"; // adjust path if needed
---

<form class="cleaning-list wide-width" id="cleaning-form">
  <h2>Bestandsaufnahme Reinigung</h2>

  {
    products.map((p) => (
      <InputField
        id={p.id}
        name={p.id}
        label={p.label}
        forOnLabel={p.forOnLabel}
        placeholderName={p.placeholderName}
      />
    ))
  }

  <div class="form-footer">
    <button type="submit">Speichern</button>
  </div>
</form>

<script>
  const form = document.getElementById("cleaning-form") as HTMLFormElement;

  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {};

      formData.forEach((value, key) => {
        data[key] = value;
      });

      console.log("Collected data:", data);

      try {
        const response = await fetch("/.netlify/functions/sendToSheets", {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        });

        const result = await response.json();
        console.log("Google Sheets response:", result);
      } catch (err) {
        console.error("Error sending data to Sheets:", err);
      }
    });
  }
</script>
